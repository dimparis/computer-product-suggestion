@model IEnumerable<CPS_Solution.EntityFramework.Product>

@{
    ViewBag.Title = "Kết quả so sánh chi tiết";
    Layout = "~/Views/Shared/_Compare.cshtml";
}

<div class="breadcrumb-container" @*style="height:60px"*@>
    <div class="container" >
        <div class="relative">
            <ul class="bc push-up unstyled clearfix">
                <li>Trang chủ</li>
                <li class="active">So sánh</li>
            </ul>
        </div>
    </div>
</div>
<style type="text/css">
    .parent {
        position: relative;
    }

    .child {
        /* CSS for warpper */
        position: absolute;
        top: 0; right: 5px;
        width: 50px;
        height: 60px;
        background-color: #F7A191;
        border-radius: 10px;
        opacity: 0.8;
        /* CSS for text */
        text-align: center;
        vertical-align: middle;
        line-height: 60px;
        font-weight: bold;
        font-size: 30px;
    }

    .center {
        margin: auto;
        width: inherit;
    }

    .handle {
        cursor: move;
        text-align: center;
    }

    .sortable-with-handles {
        list-style-type: none;
    }

    .disable-field {
        background-color: rgb(15, 64, 113);
        text-align:center;
        color:#FFFFFF;
    }

    .data-field {
        text-align:center;
    }

    li.sortable-placeholder {
			border: 1px dashed rgba(250, 111, 87, 0.73);
			background: none;
            height: 15px;
	}

    .topAttr {
        background-color: rgba(204, 0, 0, 0.5);
        color: #FFFFFF;
    }

    .winner {
        background-color: rgba(51, 153, 255, 0.75);     
    }

    .product-name {
        font-size:15px;
    }
</style>


<main id="main-content" role="main">
    <div class="container">
        <div class="row">
            <div class="m-t-b clearfix">
                <section class="col-xs-12 col-sm-4 col-md-3" style="margin-top: 0%">
                    <section class="sidebar push-up">
                        <!-- Search Panel -->

                        <!-- // Search Panel -->
                    </section>

                </section>
                <section class="col-xs-12 col-sm-8 col-md-12">
                    <div class="grid m-t-b add-cart">
                        
                        <ul class="sortable-with-handles">
                            <li class="disabled">
                                <table class="table table-bordered">
                                    <tr>
                                        <td style="width:20%" class="disable-field"><h4>Tên sản phẩm</h4></td>
                                        @foreach (var item in Model) {
                                            <td style="width:25%; vertical-align:central;" class="data-field product-name @item.ID">@Html.DisplayFor(modelItem => item.Name)</td>
                                        }
                                    </tr>
                                </table>
                            </li>
                            <li draggable="true" id="scoreCPU">
                                <table class="table table-bordered">
                                    <tr>
                                        <td style="width:20%" class="handle"><span class="pull-left"><img src="~/Template/GFashion/img/order.png" / style="margin-right:10px;"></span>Chip xử lý</td>
                                        @foreach (var item in Model) {
                                            <td style="width:25%" class="data-field" data-id="@item.ID">@Html.DisplayFor(modelItem => item.strCPU)</td>
                                            <td class="hidden"><span class="cpuScore">@item.cpuScore</span></td>
                                            <td class="hidden">@item.ID</td>
                                        }
                                    </tr>
                                </table>
                            </li>
                            <li draggable="true" id="scoreVGA">
                                <table class="table table-bordered">
                                    <tr>
                                        <td style="width:20%" class="handle"><span class="pull-left"><img src="~/Template/GFashion/img/order.png" / style="margin-right:10px;"></span>Card màn hình</td>
                                        
                                        @foreach (var item in Model) {
                                            <td style="width:25%" class="data-field" data-id="@item.ID">@Html.DisplayFor(modelItem => item.strVGA)</td>
                                            <td class="hidden"><span class="vgaScore">@item.vgaScore</span></td>
                                            <td class="hidden">@item.ID</td>
                                        }
                                    </tr>
                                </table>
                            </li>
                            <li draggable="true" id="scoreRAM">
                                <table class="table table-bordered">
                                    <tr>
                                        <td style="width:20%" class="handle"><span class="pull-left"><img src="~/Template/GFashion/img/order.png" / style="margin-right:10px;"></span>Bộ nhớ đệm</td>
                                        @foreach (var item in Model) {
                                            <td style="width:25%" class="data-field" data-id="@item.ID">@Html.DisplayFor(modelItem => item.strRAM)</td>
                                            <td class="hidden"><span class="ramScore">@item.ramScore</span></td>
                                            <td class="hidden">@item.ID</td>
                                        }
                                    </tr>
                                </table>
                            </li>
                            <li draggable="true" id="scoreHDD">
                                <table class="table table-bordered">
                                    <tr>
                                        <td style="width:20%" class="handle"><span class="pull-left"><img src="~/Template/GFashion/img/order.png" / style="margin-right:10px;"></span>Ổ cứng</td>
                                        @foreach (var item in Model) {
                                            <td style="width:25%" class="data-field" data-id="@item.ID">@Html.DisplayFor(modelItem => item.strHDD)</td>
                                            <td class="hidden"><span class="hddScore">@item.hddScore</span></td>
                                            <td class="hidden">@item.ID</td>
                                        }
                                    </tr>
                                </table>
                            </li>
                            <li draggable="true" id="scoreDisplay">
                                <table class="table table-bordered">
                                    <tr>
                                        <td style="width:20%" class="handle"><span class="pull-left"><img src="~/Template/GFashion/img/order.png" / style="margin-right:10px;"></span>Độ phân giải</td>
                                        @foreach (var item in Model) {
                                            <td style="width:25%" class="data-field">@Html.DisplayFor(modelItem => item.strDisplay)</td>
                                            <td class="hidden"><span class="displayScore">@item.displayScore</span></td>
                                            <td class="hidden">@item.ID</td>
                                        }
                                    </tr>
                                </table>
                            </li>
                            <li class="disabled">
                                <table class="table table-bordered">
                                    <tr>
                                        <td style="width:20%" class="disable-field"><h4>Tổng điểm</h4></td>
                                        @foreach (var item in Model) {
                                            <td class="data-field totalScore">@Html.DisplayFor(modelItem => item.TotalWeightPoint)</td>
                                        }
                                    </tr>
                                </table>
                            </li>
                        </ul>
                    </div>                 
                </section>
            </div>
        </div>
    </div>
</main>

<script>
    $(document).ready(function () {
        updateClass();
    });

    $(function () {
        var pro01_cpuScore = $('.cpuScore')[0].innerHTML;
        var pro01_vgaScore = $('.vgaScore')[0].innerHTML;
        var pro01_ramScore = $('.ramScore')[0].innerHTML;
        var pro01_hddScore = $('.hddScore')[0].innerHTML;
        var pro01_displayScore = $('.displayScore')[0].innerHTML;
        var pro01_total = (pro01_cpuScore + pro01_vgaScore) * 6 + (pro01_ramScore + pro01_hddScore + pro01_displayScore) * 4

        //$('.totalScore').append(pro01_total);

	    $('.sortable-with-handles').sortable({
	        handle: '.handle',
	        items: ':not(.disabled)'
	    }).bind('sortupdate', function () {
	        updateClass();
	        calc();
	    });
    });

    function updateClass() {
        var scoreCPU = $('#scoreCPU').index();
        var scoreVGA = $('#scoreVGA').index();
        var scoreRAM = $('#scoreRAM').index();
        var scoreHDD = $('#scoreHDD').index();
        var scoreDisplay = $('#scoreDisplay').index();

        if (scoreCPU == 1 || scoreCPU == 2) {
            $('#scoreCPU').addClass('topAttr');
        } else {
            $('#scoreCPU').removeClass('topAttr');
        }
        if (scoreVGA == 1 || scoreVGA == 2) {
            $('#scoreVGA').addClass('topAttr');
        } else {
            $('#scoreVGA').removeClass('topAttr');
        }
        if (scoreRAM == 1 || scoreRAM == 2) {
            $('#scoreRAM').addClass('topAttr');
        } else {
            $('#scoreRAM').removeClass('topAttr');
        }
        if (scoreHDD == 1 || scoreHDD == 2) {
            $('#scoreHDD').addClass('topAttr');
        } else {
            $('#scoreHDD').removeClass('topAttr');
        }
        if (scoreDisplay == 1 || scoreDisplay == 2) {
            $('#scoreDisplay').addClass('topAttr');
        } else {
            $('#scoreDisplay').removeClass('topAttr');
        }
    }

    function calc() {

        var products = $('.product-name');
        var attr01 = $('.topAttr')[0];
        var attr02 = $('.topAttr')[1];

        //Lay thong tin diem tung san pham
        if (products.length == 3) {
            //Product 1
            var pro01_attr01 = attr01.getElementsByTagName('span')[1].innerHTML;
            var pro01_attr02 = attr02.getElementsByTagName('span')[1].innerHTML;
            var pro01_attr03 = attr02.getElementsByTagName('td')[3].innerHTML;


            //Product 2
            var pro02_attr01 = attr01.getElementsByTagName('span')[2].innerHTML;
            var pro02_attr02 = attr02.getElementsByTagName('span')[2].innerHTML;
            var pro02_attr03 = attr02.getElementsByTagName('td')[6].innerHTML;

            //Product 3
            var pro03_attr01 = attr01.getElementsByTagName('span')[3].innerHTML;
            var pro03_attr02 = attr02.getElementsByTagName('span')[3].innerHTML;
            var pro03_attr03 = attr02.getElementsByTagName('td')[9].innerHTML;
        } else {
            //Product 1
            var pro01_attr01 = attr01.getElementsByTagName('span')[1].innerHTML;
            var pro01_attr02 = attr02.getElementsByTagName('span')[1].innerHTML;
            var pro01_attr03 = attr02.getElementsByTagName('td')[3].innerHTML;

            //Product 2
            var pro02_attr01 = attr01.getElementsByTagName('span')[2].innerHTML();
            var pro02_attr02 = attr02.getElementsByTagName('span')[2].innerHTML;
            var pro02_attr03 = attr02.getElementsByTagName('td')[6].innerHTML;
        }
        //Tinh diem cac tieu chi uu tien
        var pro01_score = parseFloat(pro01_attr01) + parseFloat(pro01_attr02);
        var pro02_score = parseFloat(pro02_attr01) + parseFloat(pro02_attr02);
        var pro03_score = parseFloat(pro03_attr01) + parseFloat(pro03_attr02);
        console.log(pro01_score, pro02_score, pro03_score)

        //So sanh san pham theo diem uu tien cao nhat
        var max = pro01_score;
        if (pro02_score > max)
            max = pro02_score
        if (pro03_score > max)
            max = pro03_score;

        //Highlight cac san pham co diem theo tieu chi uu tien cao nhat
        if (max == pro01_score) {
            $('.' + pro01_attr03).addClass("winner", 1000, "easeOutSine");
            $('.' + pro02_attr03).removeClass('winner');
            $('.' + pro03_attr03).removeClass('winner');
        } else if (max == pro02_score) {
            $('.' + pro02_attr03).addClass("winner", 1000, "easeOutSine");
            $('.' + pro01_attr03).removeClass('winner');
            $('.' + pro03_attr03).removeClass('winner');
        } else if (max == pro03_score) {
            $('.' + pro03_attr03).addClass("winner", 1000, "easeOutSine");
            $('.' + pro01_attr03).removeClass('winner');
            $('.' + pro02_attr03).removeClass('winner');
        }
        if (max == pro01_score && max == pro02_score) {
            $('.' + pro01_attr03).addClass("winner", 1000, "easeOutSine");
            $('.' + pro02_attr03).addClass("winner", 1000, "easeOutSine");
            $('.' + pro03_attr03).removeClass('winner');
        } else if (max == pro01_score && max == pro03_score) {
            $('.' + pro01_attr03).addClass("winner", 1000, "easeOutSine");
            $('.' + pro02_attr03).removeClass('winner');
            $('.' + pro03_attr03).addClass("winner", 1000, "easeOutSine");
        } else if (max == pro02_score && max == pro03_score) {
            $('.' + pro01_attr03).removeClass('winner');
            $('.' + pro02_attr03).addClass("winner", 1000, "easeOutSine");
            $('.' + pro03_attr03).addClass("winner", 1000, "easeOutSine");
        }
        if (max == pro01_score && max == pro02_score && max == pro03_score) {
            $('.' + pro01_attr03).addClass("winner", 1000, "easeOutSine");
            $('.' + pro02_attr03).addClass("winner", 1000, "easeOutSine");
            $('.' + pro03_attr03).addClass("winner", 1000, "easeOutSine");
        }
    }
</script>




